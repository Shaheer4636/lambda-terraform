'use strict';

const synthetics = require('Synthetics');
const log = require('SyntheticsLogger');

const canaryScript = async () => {
  const page = await synthetics.getPage();

  const cfg = synthetics.getConfiguration();
  cfg.setConfig({
    continueOnStepFailure: false,
    includeRequestHeaders: true,
    includeResponseHeaders: true,
    restrictedHeaders: ['x-amz-security-token'],
  });

  await page.goto('https://example.com', { waitUntil: 'domcontentloaded', timeout: 30000 });
  log.info('Landed on example.com');
  await synthetics.takeScreenshot('home', 'loaded');
};

exports.handler = async () => {
  return await synthetics.execute(canaryScript);
};


if (Test-Path canary.zip) { Remove-Item canary.zip }
Compress-Archive -Path .\index.js -DestinationPath .\canary.zip
